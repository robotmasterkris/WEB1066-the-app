language: java
jdk:
- openjdk8
- openjdk9
services:
- docker
env:
  matrix:
  - COVERAGE=0.057 BUILD_TARGET=./monolithic/ui
  - COVERAGE=0.148 BUILD_TARGET=./monolithic/service/cart
  - COVERAGE=0.0 BUILD_TARGET=./monolithic/service/user
  - COVERAGE=0.36 BUILD_TARGET=./monolithic/repository/order
  - COVERAGE=0.0 BUILD_TARGET=./monolithic/repository/cart
  - COVERAGE=0.124 BUILD_TARGET=./monolithic/repository/product
  - COVERAGE=0.318 BUILD_TARGET=./monolithic/repository/user
  global:
  - DOCKER_USERNAME=robotmasterkris
  - secure: vn6fA4EebkFKMxCypkA1Ee4uGSYBWc7hI/6E4/oqBNP3ZNiMqpLMqkB5KXJzuMuYbJ1hdEMvPMtmthActu7E1PWGis54tdf7DMtIYLY2XX6v8RxkDutrN25PniPLT0MrcOwNjuq0C5EROM+6S8vw0uJWUNADKAc81iViOB8O+4NJcbpiyQSztsqcZZyTJuBgIe+26zgReH+6popKfdN5H4ZwVgpDyreyNK7cw2jM2I2axN4OVEbGoqAt/IvrVixUm0fou8GUUR+lz1SiZgtgWK8ou5yxykD1DdIbw0P7NW5stMcQR+cjpu2xkxfb3R8s3MM4BorEk005zeeR5JDq/NBs0FLGhCG6LSRZU3QilgmEQZpaJAeqVvD8kB1sUEH5X7V6LAw6jqhEYq6GJnqvUbmIh1xcKwyEBxSNjorxQNlCOjv3fmZiyTapOm/FdAYmG/mYIRdA9Psm5K0rA31TuKmWqCOyGqomlpJvm8sZRj+VgIsxpRW3vBwiZ2neoJK9hoZ3ceVwSAR49VVDm9sKx+MrhVKZ9ohGeXNrukeZqb7OkeHU4r78a/oP1umYVcCCLXfS4ExjI9WInJL9uCSG1mIOs2beflS951PVLWJOiPNcHLNbBk1rF6obBP1rs+6Bp7DFJHDp0Fp5Udrp9/zvj3mPz7NRU9tfiy22ybIQfqw=
install:
- "./gradlew clean jar"
script:
- "./gradlew -p $BUILD_TARGET check"
after_success:
- find . -name jacocoTestReport.csv|xargs cat|awk -F',' '{print $3" "$4" "$5}'
before_deploy:
- "./gradlew -p ./monolithic/ui packageToContainer ;"
- chmod +x "./script/deploy.sh"
deploy:
  provider: script
  script: "./script/deploy.sh"
  on:
    condition: "$BUILD_TARGET == './monolithic/ui'"
    branch: master
